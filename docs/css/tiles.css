/* =============== */
/* Design tokens   */
/* =============== */
:root{
  --bg-deep: #0E1A2B;
  --bg-deeper:#0B1320;
  --ink: #EAE7E1;
  --ink-dim: #B8B3AA;
  --accent: #E1C699;

  --card-w: min(62vw, 520px);
  --card-h: calc(var(--card-w) * 5 / 3); /* 3:5 portrait */
  --radius: 18px;

  /* Motion brand (Val Head course mapping) */
  --ease-hero: cubic-bezier(0.19, 1, 0.22, 1); /* dramatic ease-in-out (expressive) */
  --ease-coda: cubic-bezier(0.39, 0.575, 0.565, 1); /* gentle ease-out (rest)  */
  --ease-overshoot: cubic-bezier(0.68, -0.55, 0.27, 1.55); /* course: overshoot */
}

/* Base */
* { box-sizing: border-box; }
html, body { height: 100%; }
body{
  margin:0;
  color: var(--ink);
  background: linear-gradient(180deg, var(--bg-deep), var(--bg-deeper));
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
  line-height: 1.35;
}

/* ===================== */
/* Starfield (endless)   */
/* ===================== */
body.starfield::before,
body.starfield::after{
  content:"";
  position: fixed; inset:0;
  pointer-events: none;
  background-repeat: repeat;
  mix-blend-mode: screen;
  opacity: .14;
  z-index: -1;
}
body.starfield::before{
  /* tiny dust */
  background-image:
    radial-gradient(#ffffff 0.8px, transparent 1px);
  background-size: 2px 2px;
  animation: driftDust 120s linear infinite;
}
body.starfield::after{
  /* sparse stars */
  background-image:
    radial-gradient(#ffffff 1px, transparent 1.5px),
    radial-gradient(#ffffff 0.7px, transparent 1.2px);
  background-size: 4px 4px, 6px 6px;
  background-position: 0 0, 30px 60px;
  opacity: .10;
  animation: driftStars 90s linear infinite;
}
@keyframes driftDust { to{ background-position: 0 600px; } }
@keyframes driftStars{ to{ background-position: 200px 400px, -160px 240px; } }

/* ===================== */
/* Hero                  */
/* ===================== */
.hero{
  min-height: 90vh;
  display:grid;
  place-items: center;
  padding: 6rem 1.25rem 2rem;
  text-align:center;
}
.hero__title{
  font-size: clamp(2rem, 5vw, 3.2rem);
  letter-spacing: .02em;
  margin: 0 0 .5rem;
  color: var(--ink);
  text-shadow: 0 0 18px rgba(225,198,153,.08);
}
.hero__tag{
  color: var(--ink-dim);
  margin: 0 0 1rem;
}
.hero__cta{
  display:inline-block;
  color: var(--accent);
  text-decoration: none;
  font-size: .95rem;
  opacity: .8;
}

/* ============================= */
/* Reveal-on-scroll visibility   */
/* (Val Head: sequence + fill)   */
/* ============================= */

/* visible when JS is missing */
.no-js .reveal .card,
.no-js .reveal .hero__inner,
.no-js .reveal .site-footer{
  opacity: 1;
  transform: none;
}

/* hide only after reveal system mounts */
.js.reveal-ready .reveal .card,
.js.reveal-ready .reveal .hero__inner,
.js.reveal-ready .reveal .site-footer,
.js.reveal-ready .reveal.site-footer{
  opacity: 0;
  transform: translateY(40px) scale(.96);
}

/* show/animate when revealed */
.js.reveal-ready .reveal.revealed .card,
.js.reveal-ready .reveal.revealed .hero__inner,
.js.reveal-ready .reveal.revealed .site-footer,
.js.reveal-ready .reveal.revealed.site-footer{
  opacity: 1;
  transform: none;
  animation: riseIn 900ms var(--ease-hero) both; /* fill-mode: both (course) */
  animation-delay: calc(var(--stagger) * 1ms);
}

/* ===================== */
/* Tarot hero sections   */
/* ===================== */
.tarot{
  min-height: 100vh;
  display:grid;
  place-items: center;
  padding: 4rem 1.25rem;
  position:relative;
}
.tap-hint{
  position:absolute;
  bottom: 1.25rem;
  left: 0; right: 0;
  text-align:center;
  font-size:.8rem;
  color: var(--ink-dim);
  opacity:.7;
}

/* Flip toggle (accessible hidden) */
.flip-toggle{
  position:absolute !important;
  width:1px; height:1px;
  margin:-1px; border:0; padding:0;
  white-space:nowrap; clip-path: inset(50%);
  clip: rect(0 0 0 0); overflow:hidden;
}

/* Card */
.card{
  width: var(--card-w);
  height: var(--card-h);
  border-radius: var(--radius);
  cursor:pointer;
  perspective: 1600px;
  will-change: transform;
  display:block;
  position:relative;
  filter: drop-shadow(0 12px 40px rgba(0,0,0,.45));
  transition: transform 220ms ease-out; /* subtle hover lift */
}

/* Micro-interaction: a tiny tilt cue (course: “motion communicates affordance”) */
.card:hover{
  transform: translateY(-2px) rotateZ(-0.25deg);
}

/* Inner / flip */
.card__inner{
  position:relative;
  width:100%; height:100%;
  transform-style: preserve-3d;
  -webkit-transform-style: preserve-3d;
  transition: transform 700ms var(--ease-overshoot); /* overshoot feel per course */
  will-change: transform;
}
.flip-toggle:checked + .card .card__inner{
  transform: rotateY(180deg);
  -webkit-transform: rotateY(180deg);
}

/* Faces */
.card__face{
  position:absolute; inset:0;
  border-radius: var(--radius);
  overflow:hidden;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
  transform: translateZ(0);
  will-change: transform;
}

.card__front{
  display:grid; place-items: center;
  background: rgba(0,0,0,.08);
  transform: rotateY(0deg) translateZ(1px);    /* push slightly forward */
  -webkit-transform: rotateY(0deg) translateZ(1px);
}
.card__front img{
  width:100%; height:100%;
  object-fit: cover;
  display:block;
  opacity: .98;
  transform: translateZ(0);
  will-change: transform;
}

/* Shimmer overlay (CSS) */
.shimmer::after{
  content:"";
  position:absolute; inset:-20%;
  background:
    linear-gradient(120deg, rgba(255,255,255,0) 30%, rgba(255,255,255,.10) 50%, rgba(255,255,255,0) 70%);
  background-size: 200% 200%;
  opacity:.22;
  animation: shimmerPass 120s linear infinite;
  animation-delay: var(--shimmer-delay, 0s);
  pointer-events: none;
}
@keyframes shimmerPass{
  0%   { transform: translateX(-8%) translateY(-6%); }
  50%  { transform: translateX(6%)  translateY(5%); }
  100% { transform: translateX(-8%) translateY(-6%); }
}

/* Back */
.card__back{
  background:
    radial-gradient(80% 60% at 50% 10%, rgba(255,255,255,.05), transparent 60%),
    rgba(12,18,30,.92);
  border: 1px solid rgba(225,198,153,.22);
  transform: rotateY(180deg) translateZ(1px);  /* match layer depth */
  -webkit-transform: rotateY(180deg) translateZ(1px);
  display:grid;
  grid-template-rows: auto auto 1fr;
  gap: 1rem;
  padding: clamp(1rem, 4vw, 1.6rem);
}
.back__title{
  margin: 0;
  font-size: clamp(1.2rem, 3.2vw, 1.7rem);
}
.back__line{
  margin:0;
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  white-space: nowrap; overflow: hidden; padding-right: 1ch;
}

/* Mobile: allow wrapping so long lines don't clip (course: guard rails for small viewports) */
@media (max-width: 480px){
  .back__line{
    white-space: normal;
    overflow: visible;
    word-break: break-word;
  }
}

/* Keep hero typing on mobile but reduce fuss: hide cursor only */
@media (max-width: 480px){
  .hero .cursor{ display: none; }
}

/* Simpler mobile motion: pause type-on, keep cursor */
@media (max-width: 480px){
  .card .back__line{
    white-space: normal;      /* was nowrap */
    overflow: visible;        /* was hidden */
  }
  .card .back__line .type-line { animation-play-state: paused; width: auto; display: inline; }
  .card .back__line .cursor { animation-play-state: running; }
}

@media (min-width: 481px){
  .card .back__line .type-line {
    max-width: calc(38 * 1ch); /* tweak number as needed */
  }
}

/* Type-on line using steps() — accurate unit & fill */
.type-line{
  display:inline-block;
  width: 0ch;
  animation: typing 1200ms steps(var(--chars)) 240ms both;
  animation-play-state: paused;               /* don’t run until triggered */
}

/* Start typing only when the card back is visible */
.flip-toggle:checked + .card .card__back .type-line{
  animation-play-state: running;
}

/* Hero: pixel-accurate typing (course: steps() + cubic-bezier via JS) */
.hero .type-line{
  white-space: nowrap;
  display: inline-block;
  width: 0;                    /* will animate to measured px width */
  animation-name: typingPx;    /* JS sets duration & delay */
  animation-timing-function: steps(var(--chars));
  animation-fill-mode: both;   /* backwards for the pre-delay, forwards to hold */
  animation-play-state: paused;
}
.hero.revealed .type-line{
  animation-play-state: running;  /* start when hero is revealed */
}

/* Blinking caret (course: steps(1) for distinct holds) */
.cursor{
  display:inline-block;
  margin-left: .1ch;
  animation: blink .8s steps(1) infinite;
  opacity:.9;
}

@keyframes typingPx{
  from { width: 0; }
  to   { width: var(--px); }   /* JS measures true pixel width */
}

.back__cta{
  align-self:end;
  display:flex; gap:.6rem; flex-wrap: wrap;
}
.btn{
  display:inline-flex; align-items:center; justify-content:center;
  padding:.6rem .9rem;
  border-radius: 10px;
  background: rgba(225,198,153,.16);
  color: var(--ink);
  text-decoration:none;
  border: 1px solid rgba(225,198,153,.28);
  transition: transform 150ms ease-out, background 150ms ease-out;
}
.btn:hover, .btn:focus{ transform: translateY(-1px) scale(1.02); background: rgba(225,198,153,.24); }
.btn--ghost{ background: transparent; }

/* Coda (two-tile grid, gentler motion) */
.coda{
  min-height: 80vh;
  display:grid;
  align-content:center;
  gap: 1.2rem;
  padding: 4rem 1.25rem 6rem;
}
.coda__card{ display:grid; place-items:center; }
@media (min-width: 920px){
  .coda{
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
  }
}
.card--mini{ --card-w: min(46vw, 420px); }

/* Coda reveal tone (no overshoot) */
.js .reveal.coda.revealed .card{
  animation: floatIn 650ms var(--ease-coda) both;
  animation-delay: calc( (var(--stagger) + (var(--index,0) * 60)) * 1ms);
}

/* Keyframes (course) */
@keyframes riseIn{
  0%   { opacity: 0; transform: translateY(40px) scale(.96); }
  85%  { opacity: 1; transform: translateY(-4px) scale(1.02); } /* overshoot */
  100% { transform: translateY(0) scale(1); }
}
@keyframes floatIn{
  from { opacity:0; transform: translateY(20px); }
  to   { opacity:1; transform: translateY(0); }
}

/* Typing + cursor (steps()) */
@keyframes typing {
  from { width: 0ch; }
  to { width: calc((var(--chars) + 1) * 1ch); } /* +1ch safety for cursor */
}
@keyframes blink{ 0%,50% {opacity:1;} 50.01%,100% {opacity:0;} }

/* Keep the cursor visible on final line */
.back__line.wrap .cursor{
  display:block;
  line-height:1;
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce){
  *{ animation: none !important; transition: none !important; }
  .js .reveal .card,
  .js .reveal .hero__inner,
  .js .reveal .site-footer,
  .js .reveal.site-footer,
  .js.reveal-ready .reveal .card,
  .js.reveal-ready .reveal .hero__inner,
  .js.reveal-ready .reveal .site-footer,
  .js.reveal-ready .reveal.site-footer,
  .js.reveal-ready .reveal.revealed .card,
  .js.reveal-ready .reveal.revealed .hero__inner,
  .js.reveal-ready .reveal.revealed .site-footer,
  .js.reveal-ready .reveal.revealed.site-footer{
    opacity: 1 !important;
    transform: none !important;
  }
}

/* Footer */
.site-footer{
  text-align:center;
  padding: 3rem 1.25rem 4rem;
  color: var(--ink-dim);
  font-size: .9rem;
}
