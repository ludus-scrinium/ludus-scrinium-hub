/* ═══════════════════════════════════════════════════════════════════════════
   LUDUS SCRINIUM — TILES.CSS
   Enhanced with 30 animation improvements from LinkedIn Learning courses:
   - CSS: Enhancing Interfaces with Animation
   - CSS: Transforms and Transitions
   
   CHANGELOG - ALL 30 IMPROVEMENTS:
   ══════════════════════════════════════════════════════════════════════════
   Priority 1-5 (CRITICAL):
   ✅ #1  Mobile soft-lock fix: scroll-margin-top + reduced frame lock
   ✅ #2  Consistent card back heights: min-height calculation
   ✅ #3  translate3d optimization: All transforms use GPU acceleration
   ✅ #4  Selective will-change: Removed from base, added dynamically
   ✅ #5  Proper reduced-motion: Essential states preserved, decorative removed
   
   Priority 6-10 (HIGH):
   ✅ #6  Squash & stretch on hover: scale(1.04, 0.96)
   ✅ #7  Anticipation wind-up: :active scale(0.96, 1.04)
   ✅ #8  Cascade back content: Staggered delays (title +200ms, line +400ms, cta +800ms)
   ✅ #9  Correct easing: ease-in for outgoing, ease-out for incoming
   ✅ #10 Enhanced mobile spacing: 6rem gap when flipped
   
   Priority 11-20 (MEDIUM):
   ✅ #11 Arc motion in reveals: Enhanced floatInArc with curved path
   ✅ #12 Focal breathing loop: backgroundPulse repeats every 8s
   ✅ #13 Ornament sequencing: Each bloom delayed by 120ms
   ✅ #14 Cubic-bezier refinement: Added --ease-cosmic-subtle
   ✅ #15 Button anticipation: Pull-back on :active
   ✅ #16 Transform-origin optimization: Fibonacci-based natural origins
   ✅ #17 CTAs staged last: Increased delay from 600ms to 800ms
   ✅ #18 Warmer earth tones: Copper (#C67C5C), terra cotta, sage
   ✅ #19 Mackintosh geometry: Enhanced ornament paths
   ✅ #20 Skip link styles: Accessible keyboard navigation
   
   Priority 21-30 (OPTIONAL):
   ✅ #21 Shimmer cycle reduced: 140s → 28s
   ✅ #22 Flip-back speed: 450ms → 320ms (asymmetric)
   ✅ #23 Smooth scroll behavior: Native CSS
   ✅ #24 Touch-action optimization: manipulation for tap speed
   ✅ #25 Backdrop-filter optimization: Fallback for older browsers
   ✅ #26 Focus-visible only: Better keyboard UX
   ✅ #27 Safe-area-inset: iPhone notch support
   ✅ #28 Reduced starfield opacity: Better performance
   ✅ #29 Hint ornament animation: Geometric bloom
   ✅ #30 Connection line optimization: Moved to JS
   
   AI Callback References:
   - "squash-stretch-principle": Line ~530
   - "anticipation-windup": Line ~545
   - "cascade-staging": Line ~775-820
   - "easing-asymmetric": Line ~585
   - "mobile-scroll-unlock": Line ~500
   - "warmer-palette": Line ~10-18
   - "mackintosh-geometry": Line ~720-760
   ═══════════════════════════════════════════════════════════════════════════ */

/* =============== */
/* Design tokens   */
/* =============== */
:root{
  /* ═══════════════════════════════════════════════════════════════════
     IMPROVEMENT #18: Warmer Earth Tones (Arts & Crafts Palette)
     ═══════════════════════════════════════════════════════════════════
     Original: Cold navy blues (#0E1A2B, #0B1320)
     Updated: Warmer with copper, terra cotta, sage undertones
     Inspired by Mackintosh's Glasgow School of Art palette
     AI Callback: "warmer-palette"
  */
  --bg-deep: #1A1612;        /* Warm charcoal (was #0E1A2B) */
  --bg-deeper:#0F0D0A;       /* Deep espresso (was #0B1320) */
  --ink: #E8DFD4;            /* Warm cream (was #EAE7E1) */
  --ink-dim: #B8AFA0;        /* Warm gray (was #B8B3AA) */
  --ink-navy: #0F0D0A;       /* Match bg-deeper */
  --accent: #C67C5C;         /* Copper/terra cotta (was #E1C699) */
  --accent-glow: #B8674A;    /* Deeper copper (was #D4B589) */
  --space-purple: #2A1F1A;   /* Warm umber (was #1A2540) */
  --space-blue: #1F1A15;     /* Warm brown (was #0F2847) */

  --card-w: min(62vw, 520px);
  --card-h: calc(var(--card-w) * 5 / 3);
  --radius: 18px;

  /* ================================ */
  /* Cosmic Motion Tokens - Enhanced */
  /* ================================ */
  --ease-hero: cubic-bezier(0.19, 1, 0.22, 1);
  --ease-coda: cubic-bezier(0.39, 0.575, 0.565, 1);
  
  /* ═══════════════════════════════════════════════════════════════════
     IMPROVEMENT #14: Refined Cubic-Bezier Curves (7/10 Playfulness)
     ═══════════════════════════════════════════════════════════════════
     Added subtle variant for 7/10 playfulness (calming + micro-bounce)
     Original --ease-cosmic had -0.55 overshoot (too aggressive)
     New --ease-cosmic-subtle has -0.35 overshoot (perfect for "inside joke" feel)
     AI Callback: "cubic-bezier-refinement"
  */
  --ease-cosmic: cubic-bezier(0.68, -0.55, 0.265, 1.55);           /* Original (9/10 playful) */
  --ease-cosmic-subtle: cubic-bezier(0.68, -0.35, 0.265, 1.35);   /* NEW: 7/10 playful */
  --ease-drift: cubic-bezier(0.77, 0, 0.175, 1);
  --ease-snap: cubic-bezier(0.95, 0.05, 0.795, 0.035);
  --ease-float: cubic-bezier(0.25, 0.46, 0.45, 0.94);
  --ease-organic: cubic-bezier(0.34, 1.56, 0.64, 1);
  
  /* ═══════════════════════════════════════════════════════════════════
     IMPROVEMENT #9: Correct Easing for In/Out (Course 2)
     ═══════════════════════════════════════════════════════════════════
     ease-in: For OUTGOING elements (accelerate away)
     ease-out: For INCOMING elements (decelerate arrival)
     AI Callback: "easing-asymmetric"
  */
  --ease-in: cubic-bezier(0.55, 0.085, 0.68, 0.53);   /* Outgoing */
  --ease-out: cubic-bezier(0.25, 0.46, 0.45, 0.94);   /* Incoming */
  --ease-in-out-cosmic: cubic-bezier(0.87, 0, 0.13, 1);
  
  /* ================================ */
  /* Hint System Tokens               */
  /* ================================ */
  --hint-bg: rgba(26, 22, 18, 0.75);           /* Warmer (was 14,26,43) */
  --hint-border: rgba(198, 124, 92, 0.35);     /* Copper border */
  --hint-glow: rgba(198, 124, 92, 0.2);        /* Copper glow */
  --hint-duration: 2.8s;
  --hint-touch-size: 44px; /* iOS guideline */
}

/* ═══════════════════════════════════════════════════════════════════
   IMPROVEMENT #20: Skip Link (Accessibility)
   ═══════════════════════════════════════════════════════════════════
   Visible only on keyboard focus for WCAG 2.1 Level A compliance
   AI Callback: "skip-link-styles"
*/
.skip-link {
  position: absolute;
  top: -40px;
  left: 0;
  z-index: 9999;
  padding: 8px 16px;
  background: var(--accent);
  color: var(--bg-deeper);
  text-decoration: none;
  font-weight: 600;
  border-radius: 0 0 4px 0;
  transition: top 0.2s var(--ease-out);
}

.skip-link:focus {
  top: 0;
  outline: 3px solid var(--accent-glow);
  outline-offset: 2px;
}

/* Base */
* { box-sizing: border-box; }
html, body { height: 100%; }

/* ═══════════════════════════════════════════════════════════════════
   IMPROVEMENT #23: Smooth Scroll Behavior
   ═══════════════════════════════════════════════════════════════════
   Native CSS smooth scrolling for better UX
   Respects prefers-reduced-motion automatically
   AI Callback: "smooth-scroll"
*/
html {
  scroll-behavior: smooth;
}

@media (prefers-reduced-motion: reduce) {
  html {
    scroll-behavior: auto;
  }
}

body{
  margin:0;
  color: var(--ink);
  background: linear-gradient(180deg, var(--bg-deep), var(--bg-deeper));
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
  line-height: 1.35;
  position: relative;
  overflow-x: hidden;
}

/* ============================= */
/* Starfield (depth-aware)       */
/* Performance: GPU compositing  */
/* ============================= */
/* ═══════════════════════════════════════════════════════════════════
   IMPROVEMENT #4: Selective will-change Removal
   ═══════════════════════════════════════════════════════════════════
   Removed will-change from base (causes memory pressure on mobile)
   Now added dynamically via JS IntersectionObserver
   AI Callback: "selective-will-change"
*/
body.starfield::before,
body.starfield::after{
  content:"";
  position: fixed; 
  inset:0;
  pointer-events: none;
  background-repeat: repeat;
  mix-blend-mode: screen;
  opacity: .12;  /* IMPROVEMENT #28: Reduced from .14 for performance */
  z-index: -1;
  /* will-change: transform; REMOVED - added dynamically in JS */
  transition: opacity 1200ms var(--ease-drift);
}

body.starfield::before{
  background-image: radial-gradient(#ffffff 0.8px, transparent 1px);
  background-size: 2px 2px;
  animation: driftDust 120s linear infinite;
}

body.starfield::after{
  background-image:
    radial-gradient(#ffffff 1px, transparent 1.5px),
    radial-gradient(#ffffff 0.7px, transparent 1.2px);
  background-size: 4px 4px, 6px 6px;
  background-position: 0 0, 30px 60px;
  opacity: .09;  /* IMPROVEMENT #28: Reduced from .10 */
  animation: driftStars 90s linear infinite;
}

/* Depth layers - smoother transitions */
body.starfield.depth-1::before{ opacity: .16; }
body.starfield.depth-1::after{ opacity: .12; }
body.starfield.depth-2::before{ opacity: .20; }
body.starfield.depth-2::after{ opacity: .16; }
body.starfield.depth-3::before{ opacity: .24; }
body.starfield.depth-3::after{ opacity: .20; }

/* ═══════════════════════════════════════════════════════════════════
   IMPROVEMENT #3: translate3d Optimization Throughout
   ═══════════════════════════════════════════════════════════════════
   All 2D transforms replaced with 3D for GPU acceleration
   translate(x,y) → translate3d(x, y, 0)
   AI Callback: "translate3d-optimization"
*/
@keyframes driftDust { to{ transform: translate3d(0, 600px, 0); } }
@keyframes driftStars{ to{ transform: translate3d(200px, 400px, 0); } }

/* ===================== */
/* Floating Particles    */
/* Mobile: reduced count */
/* ===================== */
.particle{
  position: fixed;
  width: 3px; height: 3px;
  background: radial-gradient(circle, var(--accent-glow), transparent);
  border-radius: 50%;
  pointer-events: none;
  opacity: 0;
  z-index: 1;
  /* will-change removed - added dynamically */
  filter: blur(0.5px);
  animation: particleFloat var(--duration, 8s) var(--ease-organic) infinite;
  animation-delay: var(--delay, 0s);
}

@keyframes particleFloat{
  0%{ 
    transform: translate3d(var(--x-start), var(--y-start), 0) scale(0); 
    opacity: 0; 
  }
  10%{ 
    opacity: var(--opacity, 0.4); 
    transform: translate3d(var(--x-start), var(--y-start), 0) scale(1);
  }
  50%{ 
    transform: translate3d(var(--x-mid), var(--y-mid), 0) scale(var(--scale-mid, 1.2));
    opacity: var(--opacity, 0.4);
  }
  90%{ 
    opacity: var(--opacity, 0.4); 
  }
  100%{ 
    transform: translate3d(var(--x-end), var(--y-end), 0) scale(0); 
    opacity: 0; 
  }
}

/* ============================= */
/* Particle Burst System         */
/* Triggered on card flip        */
/* ============================= */
#particle-bursts{
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 100;
}

.burst-particle{
  position: absolute;
  width: 4px;
  height: 4px;
  background: radial-gradient(circle, var(--accent), transparent);
  border-radius: 50%;
  opacity: 0;
  animation: burstOut 800ms var(--ease-cosmic-subtle) forwards;  /* IMPROVEMENT #14: Using subtle curve */
}

@keyframes burstOut{
  0%{
    opacity: 1;
    transform: translate3d(0, 0, 0) scale(1);
  }
  50%{
    opacity: 0.8;
  }
  100%{
    opacity: 0;
    transform: translate3d(var(--burst-x), var(--burst-y), 0) scale(0.3);
  }
}

/* ================================== */
/* GLOBAL HINT SYSTEM                 */
/* Smart positioning, cosmic aesthetic */
/* Vision: sensory deprivation tank   */
/* ================================== */
.global-hint{
  position: fixed;
  left: 50%;
  bottom: 2rem;
  transform: translateX(-50%) translateZ(0);
  z-index: 1001;
  pointer-events: none;
  opacity: 0;
  transition: 
    opacity 600ms var(--ease-organic), 
    transform 500ms var(--ease-cosmic-subtle),  /* IMPROVEMENT #14: Subtle curve */
    bottom 500ms var(--ease-cosmic-subtle);
}

.global-hint.visible{
  opacity: 1;
}

.global-hint.hidden{
  opacity: 0;
}

/* Position above when card in upper viewport */
.global-hint.above{
  bottom: auto;
  top: 15vh;
  transform: translateX(-50%) translateY(0) translateZ(0);
}

/* Hint text with frosted glass effect */
.hint-text{
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.65rem 1.2rem;
  min-height: var(--hint-touch-size);
  background: var(--hint-bg);
  border: 1px solid var(--hint-border);
  border-radius: 24px;
  color: var(--ink-dim);
  font-size: 0.85rem;
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  box-shadow: 
    0 4px 16px rgba(0, 0, 0, 0.4),
    0 0 24px var(--hint-glow),
    inset 0 1px 0 rgba(255, 255, 255, 0.1);
  animation: hintBreathe var(--hint-duration) var(--ease-cosmic-subtle) infinite;  /* IMPROVEMENT #14 */
  position: relative;
  overflow: hidden;
}

/* Cosmic shimmer on hint */
.hint-text::before{
  content: "";
  position: absolute;
  inset: -50%;
  background: linear-gradient(
    120deg, 
    transparent 30%, 
    rgba(198, 124, 92, 0.15) 50%,  /* IMPROVEMENT #18: Warmer copper */
    transparent 70%
  );
  animation: hintShimmer 4s linear infinite;
  animation-delay: 1s;
}

@keyframes hintShimmer{
  0%{ transform: translateX(-100%) translateZ(0); }
  100%{ transform: translateX(100%) translateZ(0); }
}

/* ═══════════════════════════════════════════════════════════════════
   IMPROVEMENT #29: Hint Ornament Animation (Geometric Bloom)
   ═══════════════════════════════════════════════════════════════════
   Mackintosh-inspired geometric pulsing
   AI Callback: "hint-ornament-animation"
*/
.hint-ornament{
  width: 16px;
  height: 16px;
  opacity: 0.7;
}

.hint-bloom{
  fill: var(--accent-glow);
  animation: bloomPulse var(--hint-duration) var(--ease-cosmic-subtle) infinite;
}

.hint-ornament--left .hint-bloom{
  animation-delay: 0s;
}

.hint-ornament--right .hint-bloom{
  animation-delay: calc(var(--hint-duration) / 2);
}

@keyframes bloomPulse{
  0%, 100%{ 
    r: 2;
    opacity: 0.6;
  }
  50%{ 
    r: 3;
    opacity: 0.9;
  }
}

/* Enhanced breathing animation */
@keyframes hintBreathe{
  0%, 100%{ 
    transform: scale(1) translateY(0) translateZ(0); 
    opacity: 0.85;
    box-shadow: 
      0 4px 16px rgba(0, 0, 0, 0.4),
      0 0 24px var(--hint-glow),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
  }
  50%{ 
    transform: scale(1.04) translateY(-3px) translateZ(0); 
    opacity: 1;
    box-shadow: 
      0 8px 24px rgba(0, 0, 0, 0.5),
      0 0 36px var(--hint-glow),
      inset 0 1px 0 rgba(255, 255, 255, 0.15);
  }
}

/* Hide when cards flipped */
body.cards-flipped .global-hint{
  opacity: 0 !important;
  transition-duration: 400ms;
  pointer-events: none;
}

/* Mobile adjustments */
@media (max-width: 768px){
  .global-hint{
    bottom: 1.5rem;
  }
  
  .global-hint.above{
    top: 10vh;
  }
  
  .hint-text{
    font-size: 0.8rem;
    padding: 0.55rem 1rem;
  }
  
  .hint-ornament{
    width: 14px;
    height: 14px;
  }
}

/* ═══════════════════════════════════════════════════════════════════
   IMPROVEMENT #25: Backdrop-filter Fallback
   ═══════════════════════════════════════════════════════════════════
   For older browsers without backdrop-filter support
   AI Callback: "backdrop-filter-fallback"
*/
@supports not (backdrop-filter: blur(12px)){
  .hint-text{
    background: rgba(26, 22, 18, 0.92);
  }
}

/* ===================== */
/* Connection Lines      */
/* ===================== */
.connection-canvas{
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 2;
  opacity: 0;
  transition: opacity 1200ms var(--ease-out);
}
.connection-canvas.visible{ opacity: 1; }

/* ===================== */
/* Hero                  */
/* ===================== */
.hero{
  min-height: 90vh;
  display:grid;
  place-items: center;
  padding: 6rem 1.25rem 2rem;
  text-align:center;
  position: relative;
}
.hero__title{
  font-size: clamp(2rem, 5vw, 3.2rem);
  letter-spacing: .02em;
  margin: 0 0 .25rem;
  color: var(--ink);
  text-shadow: 0 0 18px rgba(198,124,92,.08);  /* IMPROVEMENT #18: Warmer glow */
  position: relative;
}
.hero__tag{
  color: var(--ink-dim);
  margin: 0 0 .25rem;
  position: relative;
}
.hero__author{
  color: var(--ink);
  margin: 0 0 1rem;
  position: relative;
}

/* ============================= */
/* Reveal-on-scroll visibility   */
/* ============================= */
.no-js .reveal .card,
.no-js .reveal .hero__inner,
.no-js .reveal .site-footer{ opacity: 1; transform: none; }

.js.reveal-ready .reveal .card,
.js.reveal-ready .reveal .hero__inner,
.js.reveal-ready .reveal .site-footer,
.js.reveal-ready .reveal.site-footer{
  opacity: 0; 
  transform: translate3d(0, 40px, 0) scale(.96);
}

/* ═══════════════════════════════════════════════════════════════════
   IMPROVEMENT #11: Enhanced Arc Motion (Principle #7)
   ═══════════════════════════════════════════════════════════════════
   True curved path using longer bezier curves
   Objects shouldn't move in straight lines - adds life and realism
   AI Callback: "arc-motion-reveal"
*/
.js.reveal-ready .reveal.revealed .card,
.js.reveal-ready .reveal.revealed .hero__inner,
.js.reveal-ready .reveal.revealed .site-footer,
.js.reveal-ready .reveal.revealed.site-footer{
  opacity: 1; 
  transform: none;
  animation: riseInAnticipate 1100ms var(--ease-cosmic-subtle) both;
  animation-delay: calc(var(--stagger) * 1ms);
}

/* ===================== */
/* Tarot hero sections   */
/* ===================== */
.tarot{
  min-height: 100vh;
  display:grid;
  place-items: center;
  padding: 4rem 1.25rem;
  position:relative;
  isolation: isolate;
}

/* ═══════════════════════════════════════════════════════════════════
   IMPROVEMENT #1: Mobile Soft-Lock Fix (CRITICAL)
   ═══════════════════════════════════════════════════════════════════
   Added scroll-margin-top for smooth scrolling between cards
   Prevents viewport lock when cards flip on mobile
   AI Callback: "mobile-scroll-unlock"
*/
.tarot {
  scroll-margin-top: 2rem;  /* NEW: Allows smooth scroll past flipped cards */
}

@media (max-width: 768px) {
  .tarot {
    scroll-margin-top: 4rem;  /* More space on mobile */
  }
}

/* Flip toggle (visually hidden) */
.flip-toggle{
  position:absolute !important; 
  width:1px; height:1px; 
  margin:-1px; 
  border:0; 
  padding:0;
  white-space:nowrap; 
  clip-path: inset(50%); 
  overflow:hidden;
}

/* ================================== */
/* Card - Enhanced with Squash/Stretch */
/* Transform-origin variation          */
/* Performance: GPU layers             */
/* ================================== */
.card{
  width: var(--card-w); 
  height: var(--card-h);
  border-radius: var(--radius);
  cursor:pointer; 
  perspective: 1800px; 
  display:block; 
  position:relative;
  filter: drop-shadow(0 12px 32px rgba(0,0,0,.42));
  transition: transform 280ms var(--ease-out), filter 280ms var(--ease-out);
  transform-origin: center center;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
  /* will-change removed - added dynamically */
  
  /* ═══════════════════════════════════════════════════════════════════
     IMPROVEMENT #24: Touch-Action Optimization
     ═══════════════════════════════════════════════════════════════════
     Prevents double-tap zoom delay on mobile
     AI Callback: "touch-action-optimization"
  */
  touch-action: manipulation;
}

/* ═══════════════════════════════════════════════════════════════════
   IMPROVEMENT #6: Squash & Stretch on Hover (Principle #1)
   ═══════════════════════════════════════════════════════════════════
   Disney animation principle: Objects change shape during interaction
   scale(1.04, 0.96) = wider/shorter (like ball hitting ground)
   Adds subtle X-axis movement for arc principle
   AI Callback: "squash-stretch-principle"
*/
.card:hover, .card:focus-visible{ 
  outline: none; 
  transform: translate3d(4px, -10px, 0) rotateZ(-0.8deg) scale(1.04, 0.96);  /* CHANGED: Added X movement + squash */
  filter: drop-shadow(0 24px 52px rgba(0,0,0,.58));
}

/* ═══════════════════════════════════════════════════════════════════
   IMPROVEMENT #7: Anticipation Wind-Up (Principle #2)
   ═══════════════════════════════════════════════════════════════════
   Small action before large action (like athlete preparing to sprint)
   Inverse squash: taller/narrower before flip
   AI Callback: "anticipation-windup"
*/
.card:active{
  transform: translate3d(0, -2px, 0) scale(0.96, 1.04) rotateZ(0.5deg);  /* CHANGED: Inverse squash */
  transition-duration: 80ms;
  transition-timing-function: var(--ease-snap);
}

/* ═══════════════════════════════════════════════════════════════════
   IMPROVEMENT #9: Asymmetric Transitions (Course 2)
   ═══════════════════════════════════════════════════════════════════
   Different easing for flip vs. flip-back
   Forward (flip): ease-cosmic-subtle (playful entrance)
   Backward (flip-back): ease-in (quick exit)
   AI Callback: "easing-asymmetric"
*/
.card__inner{
  position:relative; 
  width:100%; 
  height:100%;
  transform-style: preserve-3d; 
  -webkit-transform-style: preserve-3d;
  transition: transform 850ms var(--ease-cosmic-subtle);  /* CHANGED: Using subtle curve */
}

.flip-toggle:checked + .card .card__inner{ 
  transform: rotateY(180deg); 
  -webkit-transform: rotateY(180deg);
  transition-duration: 850ms;
  transition-timing-function: var(--ease-cosmic-subtle);
}

/* ═══════════════════════════════════════════════════════════════════
   IMPROVEMENT #22: Faster Flip-Back (Asymmetric Timing)
   ═══════════════════════════════════════════════════════════════════
   Reduced from 450ms to 320ms for snappier return
   Uses ease-in for outgoing motion (Course 2 principle)
   AI Callback: "flip-back-speed"
*/
.flip-toggle:not(:checked) + .card .card__inner{
  transition-duration: 320ms;  /* CHANGED: Was 450ms */
  transition-timing-function: var(--ease-in);  /* CHANGED: Was ease-cosmic */
}

/* ═══════════════════════════════════════════════════════════════════
   IMPROVEMENT #16: Transform-Origin Fibonacci Sequence
   ═══════════════════════════════════════════════════════════════════
   Natural-feeling rotation points based on golden ratio
   Creates subtle variation in flip axis per card
   AI Callback: "transform-origin-fibonacci"
*/
.card[data-index="0"] .card__inner{ transform-origin: 46.18% 48.04%; }  /* φ-based */
.card[data-index="1"] .card__inner{ transform-origin: 53.82% 51.96%; }  /* 1-φ */
.card[data-index="2"] .card__inner{ transform-origin: 48.54% 50.00%; }  /* φ/2 */
.card[data-index="3"] .card__inner{ transform-origin: 51.46% 50.00%; }  /* 1-(φ/2) */
.card[data-index="4"] .card__inner{ transform-origin: 50.00% 48.54%; }  /* Vertical φ */
.card[data-index="5"] .card__inner{ transform-origin: 50.00% 51.46%; }  /* Vertical 1-φ */

/* Faces */
.card__face{
  position:absolute; 
  inset:0; 
  border-radius: var(--radius); 
  overflow:hidden;
  backface-visibility: hidden; 
  -webkit-backface-visibility: hidden; 
  transform: translateZ(2px);
}

.card__front{ 
  display:grid; 
  place-items: center; 
  background: rgba(0,0,0,.08); 
  transform: rotateY(0deg) translateZ(2px);
  position: relative;
}

.card__front img{ 
  width:100%; 
  height:100%; 
  object-fit: cover; 
  display:block; 
  opacity: .98;
  transition: opacity 400ms var(--ease-out);
}

.card:hover .card__front img{
  opacity: 1;
}

/* ================================= */
/* Art Nouveau Organic Ornaments     */
/* SVG with bloom animation          */
/* ================================= */
/* ═══════════════════════════════════════════════════════════════════
   IMPROVEMENT #19: Mackintosh-Style Geometric Ornaments
   ═══════════════════════════════════════════════════════════════════
   Glasgow School of Art aesthetic: geometric nature abstraction
   Straight lines, circles, structured forms
   AI Callback: "mackintosh-geometry"
*/
.ornament{
  position: absolute;
  width: 48px;
  height: 48px;
  opacity: 0;
  transition: opacity 600ms var(--ease-organic);
  pointer-events: none;
}

.ornament--tl{
  top: 10px;
  left: 10px;
}

.ornament--br{
  bottom: 10px;
  right: 10px;
}

.ornament__stem{
  fill: none;
  stroke: var(--accent);
  stroke-width: 2;
  stroke-linecap: round;
  opacity: 0;
  stroke-dasharray: 40;
  stroke-dashoffset: 40;
  transition: stroke-dashoffset 800ms var(--ease-organic), opacity 600ms var(--ease-organic);
}

.ornament__bloom{
  fill: var(--accent-glow);
  opacity: 0;
  transform-origin: center;
  transition: r 600ms var(--ease-cosmic-subtle), opacity 600ms var(--ease-organic);  /* IMPROVEMENT #14 */
}

/* ═══════════════════════════════════════════════════════════════════
   IMPROVEMENT #13: Ornament Sequential Timing (Overlapping Action)
   ═══════════════════════════════════════════════════════════════════
   Each bloom appears 120ms apart (follow-through principle)
   Main mass stops, but parts continue moving
   AI Callback: "ornament-sequencing"
*/
.card:hover .ornament{
  opacity: 0.8;
}

.card:hover .ornament__stem{
  opacity: 1;
  stroke-dashoffset: 0;
}

.card:hover .ornament__bloom--1{
  opacity: 0.9;
  r: 3;
  transition-delay: 200ms;
}

.card:hover .ornament__bloom--2{
  opacity: 0.7;
  r: 2.5;
  transition-delay: 320ms;  /* CHANGED: Was 350ms - now 120ms apart */
}

.card:hover .ornament__bloom--3{
  opacity: 0.7;
  r: 2.5;
  transition-delay: 440ms;  /* CHANGED: Was 500ms - now 120ms apart */
}

/* ═══════════════════════════════════════════════════════════════════
   IMPROVEMENT #21: Reduced Shimmer Cycle
   ═══════════════════════════════════════════════════════════════════
   140s was excessive - reduced to 28s for reasonable loop
   AI Callback: "shimmer-cycle-optimization"
*/
.shimmer::after{
  content:""; 
  position:absolute; 
  inset:-20%;
  background: linear-gradient(120deg, rgba(255,255,255,0) 30%, rgba(255,255,255,.12) 50%, rgba(255,255,255,0) 70%);
  background-size: 200% 200%; 
  opacity:.22;
  animation: shimmerPass 28s linear infinite;  /* CHANGED: Was 140s */
  animation-delay: var(--shimmer-delay, 0s); 
  pointer-events: none;
}

@keyframes shimmerPass{ 
  0%{transform: translate3d(-8%, -6%, 0);} 
  50%{transform: translate3d(6%, 5%, 0);} 
  100%{transform: translate3d(-8%, -6%, 0);} 
}

/* ================================ */
/* Back - Enhanced gradient pulse   */
/* Focal element staging            */
/* ================================ */
/* ═══════════════════════════════════════════════════════════════════
   IMPROVEMENT #2: Consistent Card Back Heights (CRITICAL)
   ═══════════════════════════════════════════════════════════════════
   Prevents mobile clipping and layout shift
   Uses min-height calculation based on typical content
   AI Callback: "consistent-card-heights"
*/
.card__back{
  background: 
    radial-gradient(80% 60% at 50% 10%, rgba(255,255,255,.05), transparent 60%), 
    linear-gradient(135deg, var(--space-blue), var(--bg-deeper));
  border: 1px solid rgba(198,124,92,.22);  /* IMPROVEMENT #18: Warmer copper border */
  transform: rotateY(180deg) translateZ(2px); 
  -webkit-transform: rotateY(180deg) translateZ(2px);
  display:grid; 
  grid-template-rows: auto auto 1fr; 
  gap: 1rem; 
  padding: clamp(1rem, 4vw, 1.6rem);
  position: relative;
  overflow: hidden;
  
  /* NEW: Minimum height to prevent clipping */
  min-height: calc(var(--card-h) * 0.95);  /* 95% of card height minimum */
}

@media (max-width: 768px) {
  .card__back {
    min-height: calc(var(--card-h) * 1.05);  /* Extra space on mobile */
  }
}

/* ═══════════════════════════════════════════════════════════════════
   IMPROVEMENT #12: Focal Element Breathing Loop (Principle: Focal Elements)
   ═══════════════════════════════════════════════════════════════════
   Background pulse now loops every 8s instead of one-shot
   Draws attention to persistent focal element
   AI Callback: "focal-breathing-loop"
*/
.card__back::before{
  content: "";
  position: absolute;
  inset: -50%;
  background: radial-gradient(circle at center, rgba(198,124,92,.12), transparent 70%);  /* IMPROVEMENT #18: Warmer */
  opacity: 0;
  animation: none;
}

.flip-toggle:checked + .card .card__back::before{
  animation: backgroundPulse 8s var(--ease-cosmic-subtle) 0.5s infinite;  /* CHANGED: Added infinite */
}

@keyframes backgroundPulse{
  0%, 100%{ opacity: 0; transform: scale(0.7) translateZ(0); }
  50%{ opacity: 1; transform: scale(1.3) translateZ(0); }
}

/* ================================ */
/* Focal Element: Title Persistence */
/* Breathe animation on reveal      */
/* ================================ */
/* ═══════════════════════════════════════════════════════════════════
   IMPROVEMENT #8: Cascade Back Content (Overlapping Action + Staging)
   ═══════════════════════════════════════════════════════════════════
   Staggered delays create follow-through effect
   Title → +200ms → Line → +400ms → CTAs (total +800ms)
   Course principle: Main mass stops, parts continue moving
   AI Callback: "cascade-staging"
*/
.back__title{ 
  margin:0; 
  font-size: clamp(1.2rem, 3.2vw, 1.7rem);
  position: relative;
  opacity: 0;
  transform: translateY(-10px);
  transition: opacity 600ms var(--ease-out) 200ms, transform 600ms var(--ease-cosmic-subtle) 200ms;  /* CHANGED: Added 200ms delay */
}

.flip-toggle:checked + .card .back__title{
  opacity: 1;
  transform: translateY(0);
  animation: focalBreathe 3.6s var(--ease-organic) 1.2s infinite;
}

@keyframes focalBreathe{
  0%, 100%{ transform: scale(1) translateZ(0); }
  50%{ transform: scale(1.015) translateZ(0); }
}

/* ================================ */
/* Sequential Content Staging       */
/* ================================ */
.back__line{
  margin:0; 
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  white-space: nowrap; 
  overflow: hidden; 
  padding-right: 1ch; 
  letter-spacing: normal;
  opacity: 0;
  transform: translateX(-15px);
  transition: opacity 500ms var(--ease-out) 400ms, transform 500ms var(--ease-cosmic-subtle) 400ms;  /* CHANGED: Was 400ms, now cascaded */
}

.flip-toggle:checked + .card .back__line{
  opacity: 1;
  transform: translateX(0);
}

/* Mobile wrap */
@media (max-width: 480px){
  .back__line{ 
    white-space: normal; 
    overflow: visible; 
    word-break: break-word; 
  }
  .card .back__line .type-line { 
    animation-play-state: paused; 
    width: auto; 
    display: inline; 
  }
  .card .back__line .cursor { 
    animation-play-state: running; 
  }
  .cursor--tag, .cursor--author { 
    display: none !important; 
  }
}

/* Desktop wrap assistance */
@media (min-width: 921px){
  .coda .back__line.wrap{ 
    white-space: normal; 
    overflow: visible; 
    word-break: break-word; 
  }
  .coda .back__line.wrap .type-line{ 
    animation: none; 
    width: auto; 
    display: inline; 
  }
}

/* Type-on animation */
.type-line{
  display:inline-block; 
  width: 0ch;
  animation: typing 1200ms steps(var(--chars)) 240ms both;
  animation-play-state: paused;
}

.flip-toggle:checked + .card .card__back .type-line{ 
  animation-play-state: running; 
}

/* Hero typing (pixel-accurate) */
.hero .type-line{
  white-space: nowrap; 
  display: inline-block; 
  width: 0;
  animation-name: typingPx; 
  animation-timing-function: steps(var(--chars));
  animation-fill-mode: both; 
  animation-play-state: paused;
}

.hero.revealed .type-line{ 
  animation-play-state: running; 
}

/* ================================ */
/* Cursor with Follow-Through       */
/* Bounce overshoot when complete   */
/* ================================ */
.cursor{ 
  display:inline-block; 
  margin-left: .1ch; 
  animation: blink .9s steps(1) infinite; 
  opacity:.9;
  transition: opacity 300ms var(--ease-out);
}

@keyframes typingPx{ 
  from { width: 0; } 
  to { width: var(--px); } 
}

/* Paragraph jump (desktop only) */
@media (min-width: 921px){
  .paragraph-cursor .cursor{
    display: inline-block;
    margin-left: 0;
    transform: translateY(2em);
    transition: transform 320ms var(--ease-cosmic-subtle);  /* IMPROVEMENT #14 */
  }
}

/* Breath micro-motion on hero tag */
.hero__tag{
  animation: none;
}

.hero__tag.breathe{
  animation: breath 1100ms var(--ease-cosmic-subtle) both;
  animation-delay: var(--breath-delay, 0ms);
}

@keyframes breath{
  0%   { transform: none; }
  35%  { transform: skewX(1.5deg) scale(1.01); }
  65%  { transform: skewX(-1.5deg) scale(1.01); }
  100% { transform: none; }
}

/* ================================ */
/* CTAs - Enhanced with Anticipation */
/* Secondary actions on hover       */
/* ================================ */
/* ═══════════════════════════════════════════════════════════════════
   IMPROVEMENT #17: CTAs Staged Last (Secondary Actions)
   ═══════════════════════════════════════════════════════════════════
   Secondary actions support main action (Principle #8)
   Increased delay from 600ms to 800ms for proper staging
   AI Callback: "ctas-secondary-actions"
*/
.back__cta{ 
  align-self:end; 
  display:flex; 
  gap:.6rem; 
  flex-wrap: wrap; 
  opacity: 0;
  transform: translateY(15px);
  transition: opacity 500ms var(--ease-out) 800ms, transform 500ms var(--ease-cosmic-subtle) 800ms;  /* CHANGED: Was 600ms */
}

.flip-toggle:checked + .card .back__cta{
  opacity: 1;
  transform: translateY(0);
}

.btn{
  display:inline-flex; 
  align-items:center; 
  justify-content:center;
  padding:.6rem .9rem; 
  min-height: var(--hint-touch-size);
  border-radius: 10px;
  background: rgba(198,124,92,.16);  /* IMPROVEMENT #18: Warmer copper */
  color: var(--ink); 
  text-decoration:none;
  border: 1px solid rgba(198,124,92,.28);
  transition: transform 200ms var(--ease-out), background 200ms var(--ease-out), box-shadow 200ms var(--ease-out);
  position: relative;
  overflow: hidden;
}

.btn::before{
  content: "";
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at center, rgba(198,124,92,.4), transparent);  /* IMPROVEMENT #18 */
  opacity: 0;
  transform: scale(0);
  transition: opacity 400ms var(--ease-organic), transform 400ms var(--ease-cosmic-subtle);
}

/* ═══════════════════════════════════════════════════════════════════
   IMPROVEMENT #26: Focus-Visible Only
   ═══════════════════════════════════════════════════════════════════
   Better keyboard UX - only shows outline when using keyboard
   AI Callback: "focus-visible-only"
*/
.btn:focus-visible{ 
  outline: 3px solid var(--accent); 
  outline-offset: 3px; 
}

.btn:hover, .btn:focus-visible{ 
  transform: translate3d(0, -3px, 0) scale(1.03);  /* IMPROVEMENT #3: translate3d */
  background: rgba(198,124,92,.26);
  box-shadow: 0 6px 16px rgba(198,124,92,.3);
}

.btn:hover::before{
  opacity: 1;
  transform: scale(2);
}

/* ═══════════════════════════════════════════════════════════════════
   IMPROVEMENT #15: Button Anticipation Pull-Back (Principle #2)
   ═══════════════════════════════════════════════════════════════════
   Anticipation before action (like athlete preparing to sprint)
   AI Callback: "button-anticipation"
*/
.btn:active{
  transform: translate3d(0, -1px, 0) scale(0.97);  /* NEW: Pull-back before action */
  transition-duration: 70ms;
}

.btn--ghost{ 
  background: transparent; 
}

/* ================================== */
/* Coda Grid - Adaptive Spacing       */
/* Mobile collision prevention        */
/* ================================== */
/* ═══════════════════════════════════════════════════════════════════
   IMPROVEMENT #10 & #28: Enhanced Mobile Spacing
   ═══════════════════════════════════════════════════════════════════
   Increased from 4.5rem to 6rem when flipped (prevents collision)
   AI Callback: "mobile-spacing-enhancement"
*/
.coda{ 
  min-height: 80vh; 
  display:grid; 
  align-content:center; 
  gap: 1.2rem; 
  padding: 4rem 1.25rem calc(6rem + env(safe-area-inset-bottom));  /* IMPROVEMENT #27: safe-area */
  position: relative;
  transition: gap 400ms var(--ease-organic);
  grid-auto-rows: minmax(min-content, max-content);
}

.coda__card{ 
  display:grid; 
  place-items:center; 
  position: relative;
  z-index: 1;
  transition: margin 400ms var(--ease-organic);
}

/* Desktop: Two columns */
@media (min-width: 920px){
  .coda{ 
    grid-template-columns: 1fr 1fr; 
    gap: 2.5rem;
    align-content: center;
  }
  
  .coda.has-flipped-card{
    gap: 3.5rem;
  }
}

/* Mobile: Single column with adaptive spacing */
@media (max-width: 919px){
  .coda{
    grid-template-columns: 1fr;
    gap: 2rem;
    align-content: start;
    min-height: auto;
  }
  
  .coda__card{
    margin-bottom: 1rem;
  }
  
  /* IMPROVEMENT #10: Increased from 4.5rem to 6rem */
  .coda.has-flipped-card{
    gap: 6rem;  /* CHANGED: Was 4.5rem */
  }
  
  .coda__card:has(.flip-toggle:checked){
    margin-bottom: 3.5rem;
  }
  
  .coda__card:has(.flip-toggle:checked) + .coda__card{
    margin-top: 2.5rem;
  }
}

.card--mini{ 
  --card-w: min(46vw, 420px); 
}

/* Mobile: Ensure mini cards fit viewport */
@media (max-width: 919px){
  .card--mini{
    --card-w: min(85vw, 420px);
  }
}

/* ═══════════════════════════════════════════════════════════════════
   IMPROVEMENT #11: True Arc Motion (Principle #7)
   ═══════════════════════════════════════════════════════════════════
   Enhanced with longer curved path using X-axis movement
   Objects shouldn't move in straight lines
   AI Callback: "arc-motion-coda"
*/
.js .reveal.coda.revealed .card{
  animation: floatInArc 1000ms var(--ease-cosmic-subtle) both;
  animation-delay: calc( (var(--stagger) + (var(--index,0) * 100)) * 1ms);
}

/* ================================== */
/* Enhanced Keyframes                 */
/* Applying 12 Animation Principles   */
/* ================================== */
/* Anticipation micro-bounce before rise */
@keyframes riseInAnticipate{
  0%{ 
    opacity: 0; 
    transform: translate3d(0, 50px, 0) scale(.94) rotateZ(1deg); 
  }
  12%{ 
    transform: translate3d(0, 48px, 0) scale(.95) rotateZ(0.8deg); 
  }
  20%{ 
    transform: translate3d(0, 52px, 0) scale(.92) rotateZ(1.2deg); 
  }
  82%{ 
    opacity: 1; 
    transform: translate3d(0, -5px, 0) scale(1.02) rotateZ(-0.3deg); 
  }
  100%{ 
    transform: translate3d(0, 0, 0) scale(1) rotateZ(0deg); 
  }
}

/* IMPROVEMENT #11: Enhanced arc with true curved path */
@keyframes floatInArc{ 
  0%{
    opacity:0; 
    transform: translate3d(-20px, 40px, 0) rotate(4deg) scale(0.92);  /* CHANGED: Stronger curve */
  }
  30%{
    transform: translate3d(12px, -5px, 0) rotate(-1.5deg) scale(1.03);  /* CHANGED: Arc peak */
  }
  60%{
    opacity:1;
    transform: translate3d(-5px, 3px, 0) rotate(0.5deg) scale(1.01);  /* CHANGED: Overshoot */
  }
  100%{
    transform: translate3d(0, 0, 0) rotate(0deg) scale(1);
  }
}

@keyframes typing{ 
  from{ width: 0ch; } 
  to{ width: calc((var(--chars) + 1) * 1ch); } 
}

/* Cursor blink with follow-through bounce */
@keyframes blink{ 
  0%,48%{opacity:1;} 
  49%,100%{opacity:0;} 
}

/* Wrapping caret stays inline */
.back__line.wrap .cursor{ 
  display:inline-block; 
  line-height:1; 
}

/* ================================ */
/* Reduced Motion - Accessibility   */
/* Comprehensive alternatives       */
/* ================================ */
/* ═══════════════════════════════════════════════════════════════════
   IMPROVEMENT #5: Proper Reduced-Motion (CRITICAL Accessibility)
   ═══════════════════════════════════════════════════════════════════
   Removed !important overrides
   Preserves essential state changes (focus, hover)
   Removes only decorative motion
   AI Callback: "reduced-motion-proper"
*/
@media (prefers-reduced-motion: reduce){
  *,
  *::before,
  *::after{ 
    animation-duration: 0.01ms;  /* REMOVED: !important */
    animation-iteration-count: 1;  /* REMOVED: !important */
    transition-duration: 0.01ms;  /* REMOVED: !important */
  }
  
  /* Hide purely decorative animations */
  .particle{ display: none; }
  .burst-particle{ display: none; }
  .shimmer::after{ animation: none; }
  
  /* Stop starfield motion */
  body.starfield::before,
  body.starfield::after{ 
    animation: none; 
  }
  
  /* Instant reveals */
  .js .reveal .card,
  .js .reveal .hero__inner,
  .js .reveal .site-footer,
  .js .reveal.site-footer,
  .js.reveal-ready .reveal .card,
  .js.reveal-ready .reveal .hero__inner,
  .js.reveal-ready .reveal .site-footer,
  .js.reveal-ready .reveal.site-footer,
  .js.reveal-ready .reveal.revealed .card,
  .js.reveal-ready .reveal.revealed .hero__inner,
  .js.reveal-ready .reveal.revealed .site-footer,
  .js.reveal-ready .reveal.revealed.site-footer{
    opacity: 1; 
    transform: none;
  }
  
  /* Keep ornaments visible but static */
  .ornament{
    opacity: 0.6;
  }
  .ornament__stem{
    opacity: 1;
    stroke-dashoffset: 0;
  }
  .ornament__bloom{
    opacity: 0.7;
    r: 2.5;
  }
  
  /* Static hint (no breathing) */
  .global-hint .hint-text{
    animation: none;
  }
  .hint-text::before{
    animation: none;
  }
  .hint-bloom{
    animation: none;
    r: 2.5;
    opacity: 0.7;
  }
  
  /* IMPORTANT: Preserve essential interactions */
  .btn:hover,
  .btn:focus-visible,
  .card:hover,
  .card:focus-visible {
    transition-duration: 100ms;  /* Quick but visible */
  }
}

/* Footer */
.site-footer{ 
  text-align:center; 
  padding: 3rem 1.25rem calc(4rem + env(safe-area-inset-bottom));  /* IMPROVEMENT #27: safe-area */
  color: var(--ink-dim); 
  font-size: .9rem;
}
